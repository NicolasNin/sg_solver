<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="darkreader-lock">
    <title>Star Genius</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .timer {
            font-family: monospace;
            font-size: 1.2em;
            font-weight: bold;
            color: #ccc;
            margin-left: 15px;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <!-- Debug indicator -->
    <div id="debug-indicator"
        style="position:fixed; top:0; left:0; right:0; background:rgba(0,0,0,0.8); color:#0f0; padding:5px; z-index:9999; font-family:monospace; font-size:12px; pointer-events:none;">
    </div>
    <script>
        // Global error handler - catches errors in ALL scripts
        window.onerror = function (msg, url, line, col, error) {
            var el = document.getElementById('debug-indicator');
            if (el) {
                el.style.background = '#f00';
                el.style.color = '#fff';
                el.textContent = 'JS ERROR: ' + msg + ' (line ' + line + ')';
            }
            return false;
        };
    </script>

    <!-- Start Modal -->
    <div id="start-modal" class="modal">
        <div class="modal-content">
            <h1>â­ <span data-i18n="title">Star Genius</span></h1>
            <p data-i18n="newGame">Choose how to start:</p>
            <div class="modal-buttons">
                <button id="btn-random" class="btn btn-primary" data-i18n="randomGame">ğŸ² Random Game</button>
                <button id="btn-choose-dice" class="btn btn-secondary" data-i18n="chooseDice">ğŸ¯ Choose Dice</button>
                <button id="btn-photo" class="btn btn-secondary" data-i18n="loadFromPhoto">ğŸ“· Gallery/Camera</button>
                <button id="btn-camera-overlay" class="btn btn-secondary">ğŸ“¸ Live Camera</button>
            </div>
            <input type="file" id="photo-input" accept="image/*" style="display: none;">
        </div>
    </div>

    <!-- Dice Selection Modal -->
    <div id="dice-modal" class="modal hidden">
        <div class="modal-content dice-modal-content">
            <h2 data-i18n="chooseBlockers">ğŸ¯ Choose Your Blockers</h2>
            <p class="dice-instructions" data-i18n="clickToSelect">Click one value per die to select blockers</p>
            <table id="dice-table">
                <tbody>
                    <tr data-die="0">
                        <td class="die-label">DÃ© 1</td>
                        <td class="die-options"></td>
                    </tr>
                    <tr data-die="1">
                        <td class="die-label">DÃ© 2</td>
                        <td class="die-options"></td>
                    </tr>
                    <tr data-die="2">
                        <td class="die-label">DÃ© 3</td>
                        <td class="die-options"></td>
                    </tr>
                    <tr data-die="3">
                        <td class="die-label">DÃ© 4</td>
                        <td class="die-options"></td>
                    </tr>
                    <tr data-die="4">
                        <td class="die-label">DÃ© 5</td>
                        <td class="die-options"></td>
                    </tr>
                    <tr data-die="5">
                        <td class="die-label">DÃ© 6</td>
                        <td class="die-options"></td>
                    </tr>
                    <tr data-die="6">
                        <td class="die-label">DÃ© 7</td>
                        <td class="die-options"></td>
                    </tr>
                </tbody>
            </table>
            <div class="dice-modal-buttons">
                <button id="btn-start-dice" class="btn btn-primary" disabled data-i18n="startGame">Start Game</button>
                <button id="btn-cancel-dice" class="btn btn-secondary" data-i18n="cancel">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Main Game Area -->
    <div id="game-container" class="hidden">
        <header>
            <h1><a href="/" style="text-decoration: none; color: inherit;">â­ <span data-i18n="title">Star
                        Genius</span></a></h1>
            <div id="header-status" data-i18n="selectPiece">Select a piece from the palette</div>
            <div class="header-controls">
                <button id="btn-menu" class="btn-icon hidden-desktop" aria-label="Menu">â˜°</button>
                <span id="player-name" class="player-name" title="Click to edit">ğŸ‘¤ Anonymous</span>
                <div id="best-time" class="best-time hidden">ğŸ† --:--</div>
                <div id="timer" class="timer">00:00</div>
            </div>
        </header>

        <main>
            <!-- Board Area -->
            <section id="board-container">
                <button id="btn-mobile-help" class="btn-mobile-overlay hidden-desktop" aria-label="Help Me">ğŸ’¡</button>
                <svg id="board-svg" viewBox="0 0 500 500"></svg>
            </section>

            <!-- Mobile Controls (only visible on mobile) -->
            <div id="mobile-controls" class="mobile-controls">
                <button id="btn-mobile-rotate" class="btn btn-mobile" data-i18n="rotateMobile">â†» Rotate</button>
                <button id="btn-mobile-flip" class="btn btn-mobile" data-i18n="flipMobile">â†” Flip</button>
            </div>

            <!-- Controls -->
            <aside id="controls" class="hidden-mobile">
                <button id="btn-close-menu" class="btn-icon-close hidden-desktop" aria-label="Close Menu">âœ•</button>
                <h2 data-i18n="newGame">New Game</h2>
                <div class="control-group">
                    <button id="btn-new-game" class="btn btn-primary" data-i18n="randomGame">ğŸ² Random Game</button>
                    <button id="btn-choose-dice-game" class="btn btn-secondary" data-i18n="chooseDice">ğŸ¯ Choose
                        Dice</button>
                </div>
                <h2 data-i18n="controls">Controls</h2>
                <div class="control-group">
                    <button id="btn-show-leaderboard" class="btn btn-secondary" data-i18n="leaderboard">ğŸ†
                        Leaderboard</button>
                    <button id="btn-reset" class="btn btn-warning" data-i18n="resetBoard">Reset Board</button>
                </div>
                <div class="control-group">
                    <button id="btn-solve" class="btn btn-primary" data-i18n="helpMe">ğŸ’¡ Help Me!</button>
                    <button id="btn-solve-full" class="btn btn-secondary" data-i18n="fullSolve">ğŸ”„ Full Solve</button>
                </div>
                <div id="controls-info">
                    <p><strong data-i18n="keyboard">Keyboard:</strong></p>
                    <ul>
                        <li><kbd>R</kbd> <span data-i18n="rotateKey">/ Scroll Rotate</span></li>
                        <li><kbd>F</kbd> <span data-i18n="flipKey">/ Right-click Flip</span></li>
                    </ul>
                </div>
                <div class="settings-section">
                    <select id="lang-select" title="Language">
                        <option value="en">ğŸ‡¬ğŸ‡§ EN</option>
                        <option value="fr">ğŸ‡«ğŸ‡· FR</option>
                    </select>
                    <select id="theme-select" title="Choose theme">
                        <option value="dark" data-i18n="dark">ğŸŒ™ Dark</option>
                        <option value="pastel" data-i18n="pastel">ğŸ¨ Pastel</option>
                    </select>
                </div>
            </aside>
        </main>
    </div>

    <!-- Leaderboard Modal -->
    <div id="leaderboard-modal" class="modal hidden">
        <div class="modal-content win-modal-content">
            <h2>ğŸ† <span data-i18n="leaderboard">Leaderboard</span></h2>
            <div id="leaderboard-table-content" class="win-leaderboard">
                <!-- Populated dynamically -->
            </div>
            <div class="win-buttons">
                <button id="btn-close-leaderboard" class="btn btn-secondary" data-i18n="close">Close</button>
            </div>
        </div>
    </div>

    <!-- Win Modal -->
    <div id="win-modal" class="modal hidden">
        <div class="modal-content win-modal-content">
            <h2>ğŸ‰ <span data-i18n="solved">Solved!</span></h2>
            <div class="win-stats">
                <p class="win-time">Your time: <span id="win-time">00:00</span></p>
                <p class="win-rank">Rank: <span id="win-rank">#1</span></p>
            </div>
            <div class="win-name-section">
                <label for="win-name-input">Your name:</label>
                <input type="text" id="win-name-input" placeholder="Anonymous" maxlength="20">
            </div>
            <div id="win-leaderboard" class="win-leaderboard">
                <!-- Populated dynamically -->
            </div>
            <div class="win-buttons">
                <button id="btn-next-game" class="btn btn-primary">ğŸ² Next Puzzle</button>
                <button id="btn-close-win" class="btn btn-secondary">Close</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading" class="hidden">
        <div class="spinner"></div>
        <p data-i18n="solving">Solving puzzle...</p>
    </div>

    <!-- Camera Modal -->
    <div id="camera-modal" class="modal hidden">
        <div class="camera-container">
            <!-- Close button -->
            <button id="btn-camera-close" class="camera-close-btn" aria-label="Close">âœ•</button>

            <!-- Video feed -->
            <video id="camera-video" playsinline autoplay muted></video>

            <!-- Board image overlay for alignment guide -->
            <img id="camera-overlay" src="board_overlay.png" alt="Board guide" />

            <!-- Guide text -->
            <div class="camera-guide-text" data-i18n="cameraGuide">Center the board in the star</div>

            <!-- Error message -->
            <div id="camera-error" class="camera-error hidden"></div>

            <!-- Capture button -->
            <button id="btn-camera-capture" class="camera-capture-btn" aria-label="Take Photo">
                <span class="capture-icon">ğŸ“¸</span>
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/pieces.js?v=11"></script>
    <script src="js/board.js?v=11"></script>
    <script src="js/game.js?v=11"></script>
    <script src="js/api.js?v=11"></script>
    <script src="js/i18n.js?v=11"></script>
    <script src="js/camera.js?v=11"></script>
    <script src="js/main.js?v=11"></script>
</body>

</html>